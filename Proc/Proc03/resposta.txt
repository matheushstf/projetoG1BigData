CREATE OR REPLACE PROCEDURE CRIAR_PEDIDO(IN IN_DATA_PEDIDO TIMESTAMP WITHOUT TIME ZONE, IN IN_COD_CLIENTE INTEGER,
										INOUT OUT_CODPEDIDO INTEGER) AS $$
DECLARE
	CODIGO_CLIENTE INTEGER;
BEGIN
	SELECT INTO CODIGO_CLIENTE COD_CLIENTE FROM CLIENTE AS C
	WHERE C.COD_CLIENTE = IN_COD_CLIENTE;
	IF (CODIGO_CLIENTE IS NULL) THEN
		RAISE EXCEPTION 'CLIENTE COM CÓDIGO % NÃO FOI ENCONTRADO', IN_COD_CLIENTE;
	ELSE 
		INSERT INTO PEDIDO(COD_CLIENTE, DATA_PEDIDO) VALUES(CODIGO_CLIENTE, IN_DATA_PEDIDO) RETURNING COD_PEDIDO
		INTO OUT_CODPEDIDO;
	END IF;
END; $$ LANGUAGE PLPGSQL;

DO $$
DECLARE
	CODIGO_PEDIDO INTEGER;
BEGIN
	CALL CRIAR_PEDIDO('2022-05-10', 10, CODIGO_PEDIDO);
	RAISE NOTICE 'CODIGO_PEDIDO: %', CODIGO_PEDIDO;
END; $$