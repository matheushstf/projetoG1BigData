Procedure 03

CREATE OR REPLACE PROCEDURE CRIAR_PEDIDO(IN IN_DATA_PEDIDO TIMESTAMP WITHOUT TIME ZONE, IN IN_COD_CLIENTE INTEGER,
										INOUT OUT_CODPEDIDO INTEGER) 
	AS $$
	DECLARE
		CODIGO_CLIENTE INTEGER;
	BEGIN

		/* Buscando o codigo do cliente para verificar se o mesmo encontra-se cadastrado. */
		SELECT INTO CODIGO_CLIENTE COD_CLIENTE FROM CLIENTE AS C
		WHERE C.COD_CLIENTE = IN_COD_CLIENTE;
	
		/* Teste de condicional para validar se a variavel do cliente não está vazia. */
		IF (CODIGO_CLIENTE IS NULL) THEN
			RAISE EXCEPTION 'CLIENTE COM CÓDIGO % NÃO FOI ENCONTRADO', IN_COD_CLIENTE;
		ELSE 
			INSERT INTO PEDIDO(COD_CLIENTE, DATA_PEDIDO) VALUES(CODIGO_CLIENTE, IN_DATA_PEDIDO) RETURNING COD_PEDIDO
			INTO OUT_CODPEDIDO;
		END IF;
	END; $$ 
LANGUAGE PLPGSQL;

DO $$
DECLARE
	CODIGO_PEDIDO INTEGER;
BEGIN
	CALL CRIAR_PEDIDO('2022-09-10', 9, CODIGO_PEDIDO);
	RAISE NOTICE 'PEDIDO CADASTRADO COM SUCESSO - Nº DO PEDIDO %', CODIGO_PEDIDO;
END; $$